path = require "path"
fs = require "fs"
clc = require('cli-color')
_ = require "underscore"

keys = [ "host", "port", "user", "color", "silent", "sound" ]

module.exports = (argv) ->
	vals = _.pick(argv, keys)
	file = argv.config

	if argv.list
		console.log "\nUser Configuration Values:"
		_.each vals, (v, k) ->
			console.log "  #{clc.red(k)} #{clc.green("=>")} #{v}"
		console.log "\nSaved to: #{clc.inverse(file)}\n"
	else if argv.remove
		reset(file)
		console.log clc.cyan(Date.create().format("[{h}:{mm}{tt}] ")) + "User config reset."
	else
		fs.writeFileSync file, JSON.stringify vals, null, "\t"
		fs.chmodSync file, 0o0777
		console.log clc.cyan(Date.create().format("[{h}:{mm}{tt}] ")) + clc.green.inverse "Saved!"

module.exports.load = (file) ->
	unless fs.existsSync(file) then return {}
	contents = fs.readFileSync file, "utf-8"
	return JSON.parse contents

reset = (file) ->
	unless fs.existsSync(file) then return {}
	fs.unlinkSync file
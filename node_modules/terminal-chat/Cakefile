exec = require("child_process").exec
fs = require 'fs'

option '-w', '--watch', 'Watch for changes'

task 'compile', 'Compile the coffee script', (options) ->
	w = if options.watch then "w" else ""
	coffee = exec "coffee -o lib/ -c#{w} src/"

	coffee.stdout.on 'data', (data) ->
		process.stdout.write data.toString "utf-8"

	coffee.stderr.on 'data', (data) ->
		process.stderr.write data.toString "utf-8"

task 'build', 'Turn js into binary', (options) ->
	data = fs.readFileSync "./lib/app.js", "utf-8"
	fs.writeFileSync "./bin/bin", "#!/usr/bin/env node\n\n#{data}"